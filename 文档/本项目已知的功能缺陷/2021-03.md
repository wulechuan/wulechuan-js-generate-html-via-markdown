<link rel="stylesheet" href="../../node_modules/@wulechuan/css-stylus-markdown-themes/源代码/发布的源代码/文章排版与配色方案集/层叠样式表/wulechuan-styles-for-html-via-markdown--vscode.default.min.css">


# 本工具之已知缺陷（ 2021-03 ）

返回《[缺陷索引](./索引.md)》。

## 2021-03-20

### 由 `highlightjs` 引起的 html 代码块的内容谬误

本工具采用 `markdown-it-highlightjs` ，由此须间接采用 `highlightjs` 。然新版本的 `highlightjs` 出现谬误，版本未堪明，只确定晚于 `9.18.x` 版，早于并包含 `10.6.x` 版。

详见《[https://github.com/highlightjs/highlight.js/issues/3059](https://github.com/highlightjs/highlight.js/issues/3059)》和更早的《[https://github.com/highlightjs/highlight.js/issues/3044](https://github.com/highlightjs/highlight.js/issues/3044)》。

> 我的应对办法：暂时回退到旧版本的 `markdown-it-highlightjs` ，即 `v3.2.0` 版，进而间接令 `highlightjs` 回退到旧版本（ `9.18.x` ）。
>
> 又，`highlightjs` 官方 Github Issues 页面的 《[3044](https://github.com/highlightjs/highlight.js/issues/3044)》提到，三天前（ 2021-03-17 ），官方已经清除了该谬误。但暂无见其通过新版本发布这一更正后的代码。不妨指出， `markdown-it-highlightjs` 也未发布新版本以采用（且无从采用） `highlightjs` 的新代码。



## 2021-03-15

### ~~由 `markdown-it-highlightjs` 引起的 html 代码块的内容谬误~~

~~详见《[https://github.com/valeriangalliat/markdown-it-highlightjs/issues/19](https://github.com/valeriangalliat/markdown-it-highlightjs/issues/19)》。~~

> ~~暂不打算“修复”。~~
>
> ~~我倾向于等待 `markdown-it-highlightjs` 官方解决此问题，而不是我在本工具中额外迂回应对。~~

> #### 现象
>
> 从如下原始的 Markdown 片段：
>
> ```html
> ```html         此处须无奈地添加以下文字，以免嵌套的 ``` 语法令 Markdown 解析器错乱。
>
> …… 此处省略了很多代码
>
> <ul>
>     <li><span>A<em>B</em>C</span></li>
>     <li><span>D<em>E</em>F</span></li>
>     <li><span>G<em>H</em>I</span></li>
> </ul>
>
> …… 此处省略了很多代码
>
> ```             此处须无奈地添加以下文字，以免嵌套的 ``` 语法令 Markdown 解析器错乱。
> ```
>
>
> 得到如下 HTML 片段：
>
> 注意其中的 `C` 、 `F` 和 `I` ，都被 `markdown-it-highlightjs` 解析成了 `class="hljs-name"` 。**这是错误的。** 它们本应该解析为普通的 HTML 内容。
>
> ```html
> <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
>     <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>A<span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>B<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;<span class="hljs-name">C</span></span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
>     <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>D<span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>E<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;<span class="hljs-name">F</span></span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
>     <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>G<span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>H<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;<span class="hljs-name">I</span></span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
> <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
> ```

> #### 验证（再现）方法
>
> 1. 打开 [https://npm.runkit.com/markdown-it-highlightjs](https://npm.runkit.com/markdown-it-highlightjs) 。
>
> 1. 在源代码输入框中输入以下全文：
>     ```js
>     const MarkdownIt = require('markdown-it')
>     const markdownItHighlightjs = require("markdown-it-highlightjs")
>    
>     const markdownItParser = new MarkdownIt({chtml: true })
>     markdownItParser.use(markdownItHighlightjs)
>    
>     const htmlString = markdownItParser.render('```html\n<ul><li><span>A<em>B</em>C</span></li></ul>\n```\n\n')
>     console.log('HTML string: ' + htmlString)
>     ```
>
> 1. 点击“ run ”按钮，运行上述代码。
>
> 1. 在输出框中以 “ **Full Text** ” 之模式观察上述程序之输出结果。截至 2021-03-15 可以看到异常。
>
>    具体而言，可以找到 `<span class="hljs-name">C</span>` 这一片段。
>