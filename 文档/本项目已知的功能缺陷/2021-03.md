<link rel="stylesheet" href="../../node_modules/@wulechuan/css-stylus-markdown-themes/源代码/发布的源代码/文章排版与配色方案集/层叠样式表/wulechuan-styles-for-html-via-markdown--vscode.default.min.css">


# 本工具之已知缺陷（ 2021-03 ）

返回《[缺陷索引](./索引.md)》。

## 2021-03-15

### 由 `markdown-it-highlightjs` 引起的 html 代码块的内容谬误。

> 暂不打算修复。
>
> 我倾向于等待 `markdown-it-highlightjs` 官方解决此问题，而不是我在本工具中额外迂回应对。

> #### 现象
>
> 从如下原始的 Markdown 片段：
>
> ```html
> ```html         此处须无奈地添加以下文字，以免嵌套的 ``` 语法令 Markdown 解析器错乱。
>
> …… 此处省略了很多代码
>
> <ul>
>     <li><span>A<em>B</em>C</span></li>
>     <li><span>D<em>E</em>F</span></li>
>     <li><span>G<em>H</em>I</span></li>
> </ul>
>
> …… 此处省略了很多代码
>
> ```             此处须无奈地添加以下文字，以免嵌套的 ``` 语法令 Markdown 解析器错乱。
> ```
>
>
> 得到如下 HTML 片段：
>
> 注意其中的 `C` 、 `F` 和 `I` ，都被 `markdown-it-highlightjs` 解析成了 `class="hljs-name"` 。**这是错误的。** 它们本应该解析为普通的 HTML 内容。
>
> ```html
> <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
>     <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>A<span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>B<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;<span class="hljs-name">C</span></span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
>     <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>D<span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>E<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;<span class="hljs-name">F</span></span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
>     <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>G<span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>H<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;<span class="hljs-name">I</span></span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
> <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
> ```

> #### 验证（再现）方法
>
> 1. 打开 [https://npm.runkit.com/markdown-it-highlightjs](https://npm.runkit.com/markdown-it-highlightjs) 。
>
> 1. 在源代码输入框中输入以下全文：
>     ```js
>     const MarkdownIt = require('markdown-it')
>     const markdownItHighlightjs = require("markdown-it-highlightjs")
>    
>     const markdownItParser = new MarkdownIt({chtml: true })
>     markdownItParser.use(markdownItHighlightjs)
>    
>     const htmlString = markdownItParser.render('```html\n<ul><li><span>A<em>B</em>C</span></li></ul>\n```\n\n')
>     console.log('HTML string: ' + htmlString)
>     ```
>
> 1. 点击“ run ”按钮，运行上述代码。
>
> 1. 在输出框中以 “ **Full Text** ” 之模式观察上述程序之输出结果。截至 2021-03-15 可以看到异常。
>
>    具体而言，可以找到 `<span class="hljs-name">C</span>` 这一片段。
>